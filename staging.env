# CoreV2 Staging Environment Configuration
# This file contains staging-specific security and configuration settings
# Staging mirrors production with enhanced debugging and testing capabilities

# Environment
NODE_ENV=staging

# Server Configuration
VITE_API_BASE_URL=https://staging-api.corev2-mental-health.app
VITE_WEBSOCKET_URL=wss://staging-api.corev2-mental-health.app
PORT=443
HOST=0.0.0.0

# Security - JWT & Session
JWT_SECRET=${STAGING_JWT_SECRET}
JWT_ALGORITHM=RS256
JWT_EXPIRES_IN=30m
JWT_REFRESH_EXPIRES_IN=7d
JWT_PRIVATE_KEY=${STAGING_JWT_PRIVATE_KEY}
JWT_PUBLIC_KEY=${STAGING_JWT_PUBLIC_KEY}
SESSION_SECRET=${STAGING_SESSION_SECRET}
SESSION_NAME=__Host-corev2-staging.sid
SESSION_MAX_AGE=3600000
SESSION_SECURE=true
SESSION_SAME_SITE=strict

# Security - Encryption Keys (Staging)
ENCRYPTION_KEY=${STAGING_ENCRYPTION_KEY}
ENCRYPTION_IV=${STAGING_ENCRYPTION_IV}
CRYPTO_ALGORITHM=aes-256-gcm
KEY_ROTATION_DAYS=60
KMS_KEY_ID=${STAGING_KMS_KEY_ID}

# Security - CORS
CORS_ORIGINS=https://staging.corev2-mental-health.app,https://staging-www.corev2-mental-health.app
CORS_CREDENTIALS=true
CORS_MAX_AGE=86400
CORS_PREFLIGHT_CONTINUE=false

# Security - Rate Limiting
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=2000
RATE_LIMIT_AUTH_MAX=10
RATE_LIMIT_CRISIS_MAX=200
RATE_LIMIT_CHAT_MAX=100
RATE_LIMIT_UPLOAD_MAX=20
RATE_LIMIT_SKIP_SUCCESSFUL=false
RATE_LIMIT_STORE=redis

# Security - CSP
CSP_REPORT_ONLY=false
CSP_REPORT_URI=https://staging-api.corev2-mental-health.app/api/security/csp-report
CSP_ENABLE_UNSAFE_EVAL=false
CSP_ENABLE_UNSAFE_INLINE=false
CSP_NONCE_ENABLED=true
CSP_UPGRADE_INSECURE_REQUESTS=true

# Security Headers
HSTS_ENABLED=true
HSTS_MAX_AGE=2592000
HSTS_INCLUDE_SUBDOMAINS=true
HSTS_PRELOAD=false
X_FRAME_OPTIONS=DENY
X_CONTENT_TYPE_OPTIONS=nosniff
REFERRER_POLICY=strict-origin-when-cross-origin
PERMISSIONS_POLICY_ENABLED=true
EXPECT_CT_ENABLED=true
EXPECT_CT_MAX_AGE=86400

# Auth0 Configuration (Staging)
VITE_AUTH0_DOMAIN=${STAGING_AUTH0_DOMAIN}
VITE_AUTH0_CLIENT_ID=${STAGING_AUTH0_CLIENT_ID}
VITE_AUTH0_CLIENT_SECRET=${STAGING_AUTH0_CLIENT_SECRET}
VITE_AUTH0_CALLBACK_URL=https://staging.corev2-mental-health.app/callback
VITE_AUTH0_AUDIENCE=https://staging-api.corev2-mental-health.app

# Database Configuration
DATABASE_URL=${STAGING_DATABASE_URL}
DATABASE_SSL=true
DATABASE_SSL_REJECT_UNAUTHORIZED=true
DATABASE_POOL_SIZE=15
DATABASE_CONNECTION_TIMEOUT=15000
DATABASE_IDLE_TIMEOUT=15000
DATABASE_MAX_USES=5000

# Redis/Cache Configuration
REDIS_URL=${STAGING_REDIS_URL}
REDIS_PASSWORD=${STAGING_REDIS_PASSWORD}
REDIS_DB=1
REDIS_TLS=true
CACHE_TTL=1800
CACHE_COMPRESSION=true

# Logging & Monitoring
LOG_LEVEL=info
LOG_FORMAT=json
LOG_ALL_REQUESTS=true
LOG_AUTH_EVENTS=true
LOG_DATA_ACCESS=true
LOG_SECURITY_EVENTS=true
LOG_PERFORMANCE=true
LOG_RETENTION_DAYS=180
LOG_ENCRYPTION=true
LOG_TO_SIEM=true

# Audit & Compliance
AUDIT_ENABLED=true
AUDIT_LOG_PATH=/var/log/corev2-staging/audit
AUDIT_ENCRYPTION=true
COMPLIANCE_REPORTING=true
DATA_RETENTION_DAYS=180
HIPAA_COMPLIANT=true
GDPR_COMPLIANT=true

# Threat Detection
THREAT_DETECTION_ENABLED=true
SQL_INJECTION_PROTECTION=true
XSS_PROTECTION=true
BRUTE_FORCE_PROTECTION=true
ANOMALY_DETECTION=true
GEO_BLOCKING=CN,RU,KP,IR
RATE_ANOMALY_THRESHOLD=2000
DDoS_PROTECTION=true

# Crisis Detection
CRISIS_DETECTION_ENABLED=true
CRISIS_OVERRIDE_ENABLED=true
CRISIS_HOTLINE=988
CRISIS_TEXT_LINE=741741
CRISIS_ALERT_WEBHOOK=${STAGING_CRISIS_WEBHOOK_URL}
CRISIS_RESPONSE_TEAM_EMAIL=${STAGING_CRISIS_TEAM_EMAIL}
CRISIS_ESCALATION_ENABLED=true

# Feature Flags
VITE_ENABLE_AI_CHAT=true
VITE_ENABLE_VIDEO_CHAT=true
VITE_ENABLE_PUSH_NOTIFICATIONS=true
VITE_ENABLE_OFFLINE_MODE=true
VITE_ENABLE_TWO_FACTOR=true
VITE_ENABLE_DEVICE_FINGERPRINTING=true
VITE_ENABLE_BIOMETRIC_AUTH=false

# Staging-Specific Features
ENABLE_DEBUG_TOOLBAR=true
ENABLE_PERFORMANCE_MONITORING=true
ENABLE_API_DOCS=true
SWAGGER_ENABLED=true
ENABLE_SYNTHETIC_MONITORING=true
ENABLE_LOAD_TESTING=true

# Email Configuration (Staging)
SMTP_HOST=${STAGING_SMTP_HOST}
SMTP_PORT=587
SMTP_SECURE=true
SMTP_USER=${STAGING_SMTP_USER}
SMTP_PASS=${STAGING_SMTP_PASS}
EMAIL_FROM=staging-support@corev2-mental-health.app
EMAIL_ENCRYPTION=true
EMAIL_SANDBOX_MODE=true

# Push Notifications (Staging)
VITE_VAPID_PUBLIC_KEY=${STAGING_VAPID_PUBLIC_KEY}
VITE_VAPID_PRIVATE_KEY=${STAGING_VAPID_PRIVATE_KEY}
PUSH_NOTIFICATION_ENABLED=true
PUSH_ENCRYPTION=true
PUSH_TEST_MODE=true

# External Services (Staging)
SENTRY_DSN=${STAGING_SENTRY_DSN}
SENTRY_ENVIRONMENT=staging
SENTRY_TRACES_SAMPLE_RATE=0.5
GA_TRACKING_ID=${STAGING_GA_TRACKING_ID}
STRIPE_SECRET_KEY=${STAGING_STRIPE_SECRET_KEY}
STRIPE_WEBHOOK_SECRET=${STAGING_STRIPE_WEBHOOK_SECRET}

# File Upload
MAX_FILE_SIZE=10485760
ALLOWED_FILE_TYPES=image/jpeg,image/png,image/gif,application/pdf
UPLOAD_PATH=/secure/uploads/staging
SCAN_UPLOADS=true
QUARANTINE_SUSPICIOUS_FILES=true

# API Security
API_KEY_REQUIRED=true
API_KEY_HEADER=X-API-Key
API_KEY_ROTATION_DAYS=60
INTERNAL_API_KEY=${STAGING_INTERNAL_API_KEY}
API_RATE_LIMIT=200
API_TIMEOUT=45000

# Testing & QA
ENABLE_TEST_ACCOUNTS=true
TEST_USER_PREFIX=test_
ENABLE_CHAOS_ENGINEERING=true
ENABLE_SECURITY_TESTING=true
ENABLE_PENETRATION_TESTING=true

# CDN & Performance
CDN_URL=https://staging-cdn.corev2-mental-health.app
CDN_ENABLED=true
IMAGE_OPTIMIZATION=true
LAZY_LOADING=true
BUNDLE_OPTIMIZATION=true

# Backup & Recovery
BACKUP_ENABLED=true
BACKUP_SCHEDULE=0 3 * * *
BACKUP_RETENTION_DAYS=14
BACKUP_ENCRYPTION=true
DISASTER_RECOVERY_ENABLED=true

# PWA Configuration
VITE_PWA_NAME=CoreV2 Staging - Mental Health Support
VITE_PWA_SHORT_NAME=CoreV2 STG
VITE_PWA_THEME_COLOR=#667eea
VITE_PWA_BACKGROUND_COLOR=#ffffff
VITE_PWA_DISPLAY=standalone
VITE_PWA_ORIENTATION=portrait

# Service Worker
VITE_SW_UPDATE_INTERVAL=600000
VITE_SW_CACHE_NAME=corev2-staging
VITE_SW_ENABLE_BACKGROUND_SYNC=true
VITE_SW_ENABLE_PUSH_SYNC=true
VITE_SW_CACHE_STRATEGY=network-first

# Privacy & Compliance
DATA_MINIMIZATION=true
RIGHT_TO_FORGETTING=true
CONSENT_MANAGEMENT=true
ANONYMIZATION=true
PSEUDONYMIZATION=true
DATA_ENCRYPTION_AT_REST=true
DATA_ENCRYPTION_IN_TRANSIT=true

# Zero Trust Security
ZERO_TRUST_ENABLED=true
DEVICE_FINGERPRINTING=true
CONTINUOUS_VALIDATION=true
RISK_BASED_ACCESS=true
LEAST_PRIVILEGE_ENABLED=true
NETWORK_SEGMENTATION=true

# Monitoring & Alerting
MONITORING_ENABLED=true
ALERT_THRESHOLD_CPU=70
ALERT_THRESHOLD_MEMORY=75
ALERT_THRESHOLD_DISK=80
ALERT_EMAIL=${STAGING_ALERT_EMAIL}
ALERT_SLACK_WEBHOOK=${STAGING_SLACK_WEBHOOK}
ENABLE_DETAILED_METRICS=true