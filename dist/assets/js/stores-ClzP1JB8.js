var e=Object.defineProperty,a=Object.defineProperties,o=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,r=(a,o,s)=>o in a?e(a,o,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[o]=s,i=(e,a)=>{for(var o in a||(a={}))t.call(a,o)&&r(e,o,a[o]);if(s)for(var o of s(a))n.call(a,o)&&r(e,o,a[o]);return e},l=(e,s)=>a(e,o(s)),m=(e,a,o)=>new Promise((s,t)=>{var n=e=>{try{i(o.next(e))}catch(a){t(a)}},r=e=>{try{i(o.throw(e))}catch(a){t(a)}},i=e=>e.done?s(e.value):Promise.resolve(e.value).then(n,r);i((o=o.apply(e,a)).next())});import{c as d}from"./state-vendor-DKNToSFz.js";import{l as p,A as c}from"./utils-D6DFWjeA.js";import{r as u}from"./react-vendor-IorqdeNj.js";import"./components-CJSBVMkT.js";var _={VITE_AUTH0_DOMAIN:"dev-ac3ajs327vs5vzhk.us.auth0.com",VITE_AUTH0_CLIENT_ID:"uGv7ns4HVxnKn5ofBdnaKqCKue1JUvZG",VITE_AUTH0_CALLBACK_URL:"http://localhost:3000/callback",VITE_API_BASE_URL:"/.netlify/functions",VITE_WEBSOCKET_URL:"ws://localhost:3000",VITE_VAPID_PUBLIC_KEY:"development-vapid-public-key-placeholder",VITE_SENTRY_DSN:"",VITE_ENABLE_AI_CHAT:"true",VITE_ENABLE_VIDEO_CHAT:"false",VITE_ENABLE_PUSH_NOTIFICATIONS:"false",VITE_ENABLE_OFFLINE_MODE:"true",VITE_DEBUG_MODE:"false",VITE_SHOW_DEV_TOOLS:"false",VITE_CRISIS_HOTLINE:"988",VITE_CRISIS_TEXT_LINE:"741741",VITE_GA_TRACKING_ID:"",VITE_PWA_NAME:"Astral Core - Mental Health Support",VITE_PWA_SHORT_NAME:"Astral Core",VITE_PWA_THEME_COLOR:"",VITE_PWA_BACKGROUND_COLOR:"",VITE_PWA_DESCRIPTION:"Anonymous peer-to-peer mental health support platform with offline crisis resources",VITE_SW_UPDATE_INTERVAL:"60000",VITE_SW_CACHE_NAME:"astral-core",VITE_SW_ENABLE_BACKGROUND_SYNC:"true",VITE_SW_ENABLE_PUSH_SYNC:"false",VITE_PWA_DISPLAY:"standalone",VITE_PWA_ORIENTATION:"portrait",VITE_PWA_START_URL:"/",VITE_PWA_SCOPE:"/",VITE_OFFLINE_FALLBACK_PAGE:"/offline.html",VITE_OFFLINE_CRISIS_PAGE:"/offline-crisis.html",VITE_ENABLE_OFFLINE_ANALYTICS:"true",VITE_ENABLE_INSTALL_PROMPT:"true",VITE_INSTALL_PROMPT_DELAY:"5000",VITE_INSTALL_PROMPT_FREQUENCY:"7",VITE_ENABLE_SHARE_TARGET:"true",VITE_SHARE_TARGET_URL:"/share",DATABASE_URL:"postgresql://neondb_owner:npg_IrC1uWYi3FdA@ep-floral-lake-aeiztgic-pooler.c-2.us-east-2.aws.neon.tech/neondb?sslmode=require&channel_binding=require",AUTH0_CLIENT_SECRET:"demo-auth0-client-secret-min-32-characters-for-production",JWT_SECRET:"development-jwt-secret-key-must-be-32-characters-or-longer-for-security",VITE_OTEL_ENABLED:"false",VITE_OTEL_ENDPOINT:"",VITE_OTEL_API_KEY:"",VITE_APP_VERSION:"1.0.0",VITE_AUTH0_AUDIENCE:"http://localhost:3000/api",SESSION_SECRET:"development-session-secret-key-must-be-32-characters-or-longer-for-security",NODE_ENV:"production",VITE_API_URL:"/.netlify/functions",VITE_AUTH_OPTIONAL:"true",VITE_ALLOW_ANONYMOUS:"true",ACSetupSvcPort:"23210",ALLUSERSPROFILE:"C:\\ProgramData",ANDROID_SDK_ROOT:"C:\\Users\\damat\\AppData\\Local\\Android\\Sdk",APPDATA:"C:\\Users\\damat\\AppData\\Roaming",ChocolateyInstall:"C:\\ProgramData\\chocolatey",ChocolateyLastPathUpdate:"133947761431510901",CHROME_CRASHPAD_PIPE_NAME:"\\\\.\\pipe\\crashpad_63148_PAITOUHBJETQCUJU",CI:"true",CLAUDE_CODE_MAX_OUTPUT_TOKENS:"32000",CLAUDE_CODE_SSE_PORT:"51573",COLOR:"1",COLORTERM:"truecolor",CommonProgramFiles:"C:\\Program Files\\Common Files","CommonProgramFiles(x86)":"C:\\Program Files (x86)\\Common Files",CommonProgramW6432:"C:\\Program Files\\Common Files",COMPUTERNAME:"DEMONWALL_EXE",ComSpec:"C:\\WINDOWS\\system32\\cmd.exe",CURSOR_TRACE_ID:"3b8302348a734895b48542bd45043e1f",DriverData:"C:\\Windows\\System32\\Drivers\\DriverData",EDITOR:"C:\\WINDOWS\\notepad.exe",EFC_13896_1592913036:"1",ENABLE_IDE_INTEGRATION:"true",FORCE_COLOR:"0",FPS_BROWSER_APP_PROFILE_STRING:"Internet Explorer",FPS_BROWSER_USER_PROFILE_STRING:"Default",GIT_ASKPASS:"c:\\Users\\damat\\AppData\\Local\\Programs\\cursor\\resources\\app\\extensions\\git\\dist\\askpass.sh",GRADLE_HOME:"C:\\gradle\\gradle-8.14.3\\bin\\gradle-8.14.2",HOME:"C:\\Users\\damat",HOMEDRIVE:"C:",HOMEPATH:"\\Users\\damat",INIT_CWD:"C:\\Users\\damat\\_REPOS\\CoreV2_Mental_Health_Platform","IntelliJ IDEA":"C:\\Program Files\\JetBrains\\IntelliJ IDEA 2025.2\\bin",JAVA_HOME:"C:\\Program Files\\Microsoft\\jdk-21.0.8.9-hotspot",KMP_BLOCKTIME:"0",LANG:"en_US.UTF-8",LOCALAPPDATA:"C:\\Users\\damat\\AppData\\Local",LOGONSERVER:"\\\\DEMONWALL_EXE",NODE:"C:\\Program Files\\nodejs\\node.exe",NODE_EXE:"C:\\Program Files\\nodejs\\\\node.exe",NODE_OPTIONS:"--max-old-space-size=8192",npm_command:"exec",npm_config_cache:"C:\\Users\\damat\\AppData\\Local\\npm-cache",npm_config_globalconfig:"C:\\Users\\damat\\AppData\\Roaming\\npm\\etc\\npmrc",npm_config_global_prefix:"C:\\Users\\damat\\AppData\\Roaming\\npm",npm_config_init_module:"C:\\Users\\damat\\.npm-init.js",npm_config_local_prefix:"C:\\Users\\damat\\_REPOS\\CoreV2_Mental_Health_Platform",npm_config_loglevel:"silent",npm_config_node_gyp:"C:\\Program Files\\nodejs\\node_modules\\npm\\node_modules\\node-gyp\\bin\\node-gyp.js",npm_config_noproxy:"",npm_config_npm_version:"10.9.2",npm_config_prefix:"C:\\Users\\damat\\AppData\\Roaming\\npm",npm_config_userconfig:"C:\\Users\\damat\\.npmrc",npm_config_user_agent:"npm/10.9.2 node/v22.17.0 win32 x64 workspaces/false",npm_execpath:"C:\\Program Files\\nodejs\\node_modules\\npm\\bin\\npm-cli.js",npm_lifecycle_event:"npx",npm_lifecycle_script:"vite",npm_node_execpath:"C:\\Program Files\\nodejs\\node.exe",npm_package_engines_node:">=20.19.0",npm_package_engines_npm:">=10.0.0",npm_package_json:"C:\\Users\\damat\\_REPOS\\CoreV2_Mental_Health_Platform\\package.json",npm_package_name:"astral-core-react",npm_package_version:"1.0.0",NPM_PREFIX_JS:"C:\\Program Files\\nodejs\\\\node_modules\\npm\\bin\\npm-prefix.js",NPM_PREFIX_NPX_CLI_JS:"C:\\Users\\damat\\AppData\\Roaming\\npm\\node_modules\\npm\\bin\\npx-cli.js",NPX_CLI_JS:"C:\\Program Files\\nodejs\\\\node_modules\\npm\\bin\\npx-cli.js",NUMBER_OF_PROCESSORS:"32",OMP_WAIT_POLICY:"PASSIVE",OneDrive:"C:\\Users\\damat\\OneDrive",OneDriveConsumer:"C:\\Users\\damat\\OneDrive",ORIGINAL_XDG_CURRENT_DESKTOP:"undefined",OS:"Windows_NT",Path:"C:\\Users\\damat\\_REPOS\\CoreV2_Mental_Health_Platform\\node_modules\\.bin;C:\\Users\\damat\\_REPOS\\CoreV2_Mental_Health_Platform\\node_modules\\.bin;C:\\Users\\damat\\_REPOS\\node_modules\\.bin;C:\\Users\\damat\\node_modules\\.bin;C:\\Users\\node_modules\\.bin;C:\\node_modules\\.bin;C:\\Program Files\\nodejs\\node_modules\\npm\\node_modules\\@npmcli\\run-script\\lib\\node-gyp-bin;C:\\Users\\damat\\_REPOS\\CoreV2_Mental_Health_Platform\\node_modules\\.bin;C:\\Users\\damat\\_REPOS\\node_modules\\.bin;C:\\Users\\damat\\node_modules\\.bin;C:\\Users\\node_modules\\.bin;C:\\node_modules\\.bin;C:\\Program Files\\nodejs\\node_modules\\npm\\node_modules\\@npmcli\\run-script\\lib\\node-gyp-bin;C:\\Users\\damat\\AppData\\Local\\cloud-code\\installer\\google-cloud-sdk\\bin;C:\\Program Files\\Microsoft\\jdk-21.0.8.9-hotspot\\bin;C:\\Program Files\\Microsoft\\jdk-17.0.16.8-hotspot\\bin;C:\\Gradle\\gradle-9.0.0\\bin;C:\\Program Files\\Eclipse Adoptium\\jdk-11.0.27.6-hotspot\\bin;C:\\Program Files\\Eclipse Adoptium\\jdk-8.0.452.9-hotspot\\bin;c:\\Users\\damat\\AppData\\Local\\Programs\\cursor\\resources\\app\\bin;c:\\Users\\damat\\AppData\\Local\\Programs\\cursor\\resources\\app\\bin;c:\\Users\\damat\\AppData\\Local\\Programs\\cursor\\resources\\app\\bin;C:\\Program Files\\Common Files\\Oracle\\Java\\javapath;C:\\Program Files (x86)\\Common Files\\Oracle\\Java\\java8path;C:\\Program Files (x86)\\Common Files\\Oracle\\Java\\javapath;C:\\WINDOWS\\system32;C:\\WINDOWS;C:\\WINDOWS\\System32\\Wbem;C:\\WINDOWS\\System32\\WindowsPowerShell\\v1.0\\;C:\\WINDOWS\\System32\\OpenSSH\\;C:\\Program Files\\dotnet\\;C:\\Program Files\\NVIDIA Corporation\\NVIDIA App\\NvDLISR;C:\\Program Files (x86)\\NVIDIA Corporation\\PhysX\\Common;C:\\Program Files\\Calibre2\\;C:\\Program Files\\Git\\cmd;C:\\Program Files\\Eclipse Adoptium\\jdk-21.0.7.6-hotspot\\bin;C:\\Android\\platform-tools;C:\\Users\\damat\\OneDrive\\Documents\\_AAAA\\jdk-21.0.4\\bin;C:\\Users\\damat\\OneDrive\\Documents\\_AAAA\\java-21-openjdk-21.0.4.0.7-1.win.jdk.x86_64\\bin;C:\\Users\\damat\\AppData\\Local\\Programs\\Python\\Launcher\\;C:\\Users\\damat\\AppData\\Local\\Microsoft\\WindowsApps;C:\\Users\\damat\\AppD;C:\\Program Files\\GitHub CLI\\;C:\\Program Files\\Java\\jdk-17\\bin;C:\\Program Files (x86)\\Google\\Cloud SDK\\google-cloud-sdk\\bin;C:\\Program Files\\Docker\\Docker\\resources\\bin;C:\\protoc\\bin;C:\\Program Files\\Eclipse Adoptium\\jdk-11.0.27.6-hotspot\\bin;C:\\Program Files\\Eclipse Adoptium\\jdk-8.0.452.9-hotspot\\bin;c:\\Users\\damat\\AppData\\Local\\Programs\\cursor\\resources\\app\\bin;c:\\Users\\damat\\AppData\\Local\\Programs\\cursor\\resources\\app\\bin;c:\\Users\\damat\\AppData\\Local\\Programs\\cursor\\resources\\app\\bin;C:\\Program Files\\Common Files\\Oracle\\Java\\javapath;C:\\Program Files (x86)\\Common Files\\Oracle\\Java\\java8path;C:\\Program Files (x86)\\Common Files\\Oracle\\Java\\javapath;C:\\WINDOWS\\system32;C:\\WINDOWS;C:\\WINDOWS\\System32\\Wbem;C:\\WINDOWS\\System32\\WindowsPowerShell\\v1.0\\;C:\\WINDOWS\\System32\\OpenSSH\\;C:\\Program Files\\dotnet\\;C:\\Program Files\\NVIDIA Corporation\\NVIDIA App\\NvDLISR;C:\\Program Files (x86)\\NVIDIA Corporation\\PhysX\\Common;C:\\Program Files\\Calibre2\\;C:\\Program Files\\Git\\cmd;C:\\Program Files\\Eclipse Adoptium\\jdk-21.0.7.6-hotspot\\bin;C:\\Android\\platform-tools;C:\\Users\\damat\\OneDrive\\Documents\\_AAAA\\jdk-21.0.4\\bin;C:\\Users\\damat\\OneDrive\\Documents\\_AAAA\\java-21-openjdk-21.0.4.0.7-1.win.jdk.x86_64\\bin;C:\\Users\\damat\\AppData\\Local\\Programs\\Python\\Launcher\\;C:\\Users\\damat\\AppData\\Local\\Microsoft\\WindowsApps;C:\\Users\\damat\\AppD;C:\\Program Files\\GitHub CLI\\;C:\\Program Files\\Java\\jdk-17\\bin;C:\\Program Files (x86)\\Google\\Cloud SDK\\google-cloud-sdk\\bin;C:\\Program Files\\Docker\\Docker\\resources\\bin;C:\\Users\\damat\\.cargo\\bin;C:\\Users\\damat\\OneDrive\\Documents\\_AAAA\\jdk-21.0.4\\bin;C:\\Users\\damat\\OneDrive\\Documents\\_AAAA\\java-21-openjdk-21.0.4.0.7-1.win.jdk.x86_64\\bin;C:\\Users\\damat\\AppData\\Local\\Programs\\Python\\Launcher\\;C:\\Users\\damat\\AppData\\Local\\Microsoft\\WindowsApps;C:\\Users\\damat\\AppData\\Local\\Programs\\Windsurf\\bin;C:\\Users\\damat\\AppData\\Local\\Programs\\Microsoft VS Code\\bin;C:\\Users\\damat\\Downloads\\java-1.8.0-openjdk-1.8.0.392-1.b08.redhat.windows.x86_64\\bin;C:\\Users\\damat\\Downloads\\java-1.8.0-openjdk-1.8.0.392-1.b08.redhat.windows.x86_64\\java-1.8.0-openjdk-1.8.0.392-1.b08.redhat.windows.x86_64\\jre\\bin;C:\\Users\\damat\\Downloads\\java-1.8.0-openjdk-1.8.0.392-1.b08.redhat.windows.x86_64\\jdk8u392-b08\\bin;C:\\Program Files\\Java\\jdk-17\\bin;C:\\Users\\damat\\Downloads\\gradle-8.14.2-all\\gradle-8.14.2\\bin;C:\\Users\\damat\\AppData\\Roaming\\ffmpeg\\ffmpeg-7.1.1-essentials_build\\bin;C:\\Users\\damat\\AppData\\Local\\Microsoft\\WinGet\\Links;C:\\Program Files\\Eclipse Adoptium\\jdk-21.0.7.6-ho;C:\\Users\\damat\\AppData\\Local\\Android\\platform-tools;C:\\Users\\damat\\.dotnet\\tools;C:\\Users\\damat\\AppData\\Local\\Programs\\cursor\\resources\\app\\bin;C:\\Users\\damat\\AppData\\Roaming\\npm;C:\\Program Files\\nodejs;C:\\Users\\damat\\AppData\\Local\\GitHubDesktop\\bin;C:\\Users\\damat\\.fly\\bin;C:\\Users\\damat\\AppData\\Local\\JetBrains\\Toolbox\\scripts;;C:\\prot",PATHEXT:".COM;.EXE;.BAT;.CMD;.VBS;.VBE;.JS;.JSE;.WSF;.WSH;.MSC;.CPL",PROCESSOR_ARCHITECTURE:"AMD64",PROCESSOR_IDENTIFIER:"Intel64 Family 6 Model 183 Stepping 1, GenuineIntel",PROCESSOR_LEVEL:"6",PROCESSOR_REVISION:"b701",ProgramData:"C:\\ProgramData",ProgramFiles:"C:\\Program Files","ProgramFiles(x86)":"C:\\Program Files (x86)",ProgramW6432:"C:\\Program Files",PROMPT:"$P$G",PSModulePath:"C:\\Users\\damat\\Documents\\WindowsPowerShell\\Modules;C:\\Users\\damat\\AppData\\Local\\Google\\Cloud SDK\\google-cloud-sdk\\platform\\PowerShell;C:\\Program Files\\WindowsPowerShell\\Modules;C:\\WINDOWS\\system32\\WindowsPowerShell\\v1.0\\Modules;C:\\Program Files (x86)\\Google\\Cloud SDK\\google-cloud-sdk\\platform\\PowerShell",PUBLIC:"C:\\Users\\Public",RlsSvcPort:"22112",SESSIONNAME:"Console",SystemDrive:"C:",SystemRoot:"C:\\WINDOWS",TEMP:"C:\\Users\\damat\\AppData\\Local\\Temp",TERM_PROGRAM:"vscode",TERM_PROGRAM_VERSION:"1.4.5",TMP:"C:\\Users\\damat\\AppData\\Local\\Temp",USERDOMAIN:"DEMONWALL_EXE",USERDOMAIN_ROAMINGPROFILE:"DEMONWALL_EXE",USERNAME:"damat",USERPROFILE:"C:\\Users\\damat",VITE_USER_NODE_ENV:"production",VSCODE_GIT_ASKPASS_EXTRA_ARGS:"",VSCODE_GIT_ASKPASS_MAIN:"c:\\Users\\damat\\AppData\\Local\\Programs\\cursor\\resources\\app\\extensions\\git\\dist\\askpass-main.js",VSCODE_GIT_ASKPASS_NODE:"C:\\Users\\damat\\AppData\\Local\\Programs\\cursor\\Cursor.exe",VSCODE_GIT_IPC_HANDLE:"\\\\.\\pipe\\vscode-git-097521b929-sock",VSCODE_INJECTION:"1",windir:"C:\\WINDOWS",ZES_ENABLE_SYSMAN:"1"};const C=(e,a)=>{var o,s;return"undefined"!=typeof window&&(null==(s=null==(o=window.import)?void 0:o.meta)?void 0:s.env)?window.import.meta.env[e]||a:"undefined"!=typeof process&&_[e]?_[e]:a};C("VITE_AUTH0_DOMAIN","demo.auth0.com"),C("VITE_AUTH0_CLIENT_ID","demo-client-id"),C("VITE_AUTH0_AUDIENCE","demo-audience");if(("true"===C("DEV","false")||"true"===C("VITE_DEV","false"))&&(!C("VITE_AUTH0_DOMAIN","")||!C("VITE_AUTH0_CLIENT_ID","")||!C("VITE_AUTH0_AUDIENCE",""))){const e="undefined"!=typeof window?window.location.port:"";e&&"8888"!==e&&p.info("âœ“ Running in demo mode - Auth0 not required",void 0,"AuthContext")}const g=null,E=u.createContext(void 0),I=()=>{const e=u.useContext(E);if(void 0===e)throw new Error("useAuth must be used within an AuthProvider");return e},S=d((e,a)=>{const o=e=>{const{allDilemmas:a,filter:o,sort:s,searchTerm:t,currentPage:n,blockedUserIds:r}=e,i=a.filter(e=>e.isReported&&"removed_by_moderator"!==e.status);let l=a.filter(e=>"active"===e.status&&!e.assignedHelperId&&!e.isReported&&!r.has(e.userToken));if("All"!==o&&(l=l.filter(e=>e.category===o)),t){const e=t.toLowerCase();l=l.filter(a=>a.content.toLowerCase().includes(e))}switch(s){case"newest":l.sort((e,a)=>new Date(a.timestamp).getTime()-new Date(e.timestamp).getTime());break;case"most-support":l.sort((e,a)=>a.supportCount-e.supportCount);break;case"needs-support":l.sort((e,a)=>e.supportCount-a.supportCount)}const m=l.slice(0,10*n);return{reportedDilemmas:i,visibleDilemmas:m,hasMore:m.length<l.length}};return{allDilemmas:[],forYouDilemmas:[],isLoading:!0,filter:"All",sort:"newest",searchTerm:"",currentPage:1,reportingDilemmaId:null,isReportModalOpen:!1,blockedUserIds:new Set,reportedDilemmas:[],visibleDilemmas:[],hasMore:!1,fetchDilemmas:()=>m(null,null,function*(){e({isLoading:!0});try{const a=yield c.dilemmas.getDilemmas();e(e=>i(l(i({},e),{allDilemmas:a,isLoading:!1}),o(l(i({},e),{allDilemmas:a}))))}catch(a){const s=[{id:"community-1",userToken:"user-abc123",content:"I've been struggling with social anxiety for months. Every time I need to speak up in meetings, my heart races and I freeze up. Has anyone found effective ways to manage this?",category:"Anxiety",timestamp:new Date(Date.now()-36e5).toISOString(),supportCount:12,isSupported:!1,isReported:!1,reportReason:void 0,status:"active",assignedHelperId:void 0,resolved_by_seeker:!1,requestedHelperId:void 0,summary:void 0,summaryLoading:!1,moderation:{action:"dismissed",timestamp:(new Date).toISOString(),moderatorId:"system"}},{id:"community-2",userToken:"user-def456",content:"Going through a difficult breakup after 3 years together. The loneliness hits hardest in the evenings. Looking for healthy coping strategies that have worked for others.",category:"Relationships",timestamp:new Date(Date.now()-108e5).toISOString(),supportCount:8,isSupported:!0,isReported:!1,reportReason:void 0,status:"active",assignedHelperId:void 0,resolved_by_seeker:!1,requestedHelperId:void 0,summary:void 0,summaryLoading:!1,moderation:{action:"dismissed",timestamp:(new Date).toISOString(),moderatorId:"system"}},{id:"community-3",userToken:"user-ghi789",content:"Started a new exercise routine to help with depression. Week 2 and already feeling more energy. For anyone considering it - even 15 minutes of walking helps!",category:"Coping Strategies",timestamp:new Date(Date.now()-18e6).toISOString(),supportCount:25,isSupported:!1,isReported:!1,reportReason:void 0,status:"active",assignedHelperId:void 0,resolved_by_seeker:!1,requestedHelperId:void 0,summary:void 0,summaryLoading:!1,moderation:{action:"dismissed",timestamp:(new Date).toISOString(),moderatorId:"system"}}];e(e=>i(l(i({},e),{allDilemmas:s,isLoading:!1}),o(l(i({},e),{allDilemmas:s}))))}}),fetchForYouFeed:()=>m(null,null,function*(){}),setFilter:a=>e(e=>{const s=l(i({},e),{filter:a,currentPage:1});return i(i({},s),o(s))}),setSort:a=>e(e=>{const s=l(i({},e),{sort:a});return i(i({},s),o(s))}),setSearchTerm:a=>e(e=>{const s=l(i({},e),{searchTerm:a,currentPage:1});return i(i({},s),o(s))}),loadMore:()=>e(e=>{const a=l(i({},e),{currentPage:e.currentPage+1});return i(i({},a),o(a))}),openReportModal:a=>e({reportingDilemmaId:a,isReportModalOpen:!0}),closeReportModal:()=>e({reportingDilemmaId:null,isReportModalOpen:!1}),getDilemmaById:e=>a().allDilemmas.find(a=>a.id===e),postDilemma:(e,o)=>m(null,null,function*(){yield c.dilemmas.postDilemma(e,o),yield a().fetchDilemmas()}),createDirectRequest:(e,o,s)=>m(null,null,function*(){yield c.dilemmas.createDirectRequest(e,o,s),yield a().fetchDilemmas()}),toggleSupport:a=>m(null,null,function*(){const s=yield c.dilemmas.toggleSupport(a);e(e=>{const a=e.allDilemmas.map(e=>e.id===s.id?s:e),t=l(i({},e),{allDilemmas:a});return i(i({},t),o(t))})}),reportDilemma:s=>m(null,null,function*(){const{reportingDilemmaId:t}=a();if(!t)return;const n=yield c.dilemmas.report(t,s);e(e=>{const a=e.allDilemmas.map(e=>e.id===n.id?n:e),s=l(i({},e),{allDilemmas:a,reportingDilemmaId:null});return i(i({},s),o(s))})}),acceptDilemma:e=>m(null,null,function*(){throw new Error("Helper profile not found")}),declineRequest:e=>m(null,null,function*(){throw new Error("Helper profile not found")}),resolveDilemma:(a,s)=>m(null,null,function*(){const t=yield c.dilemmas.resolveBySeeker(a,s);e(e=>{const a=e.allDilemmas.map(e=>e.id===t.id?t:e),s=l(i({},e),{allDilemmas:a});return i(i({},s),o(s))})}),summarizeDilemma:o=>m(null,null,function*(){const s=a().allDilemmas.find(e=>e.id===o);if(s){e(e=>({allDilemmas:e.allDilemmas.map(e=>e.id===o?l(i({},e),{summaryLoading:!0}):e)}));try{const a=yield c.ai.summarizeDilemma(s.content);e(e=>({allDilemmas:e.allDilemmas.map(e=>e.id===o?l(i({},e),{summary:a,summaryLoading:!1}):e)}))}catch(t){e(e=>({allDilemmas:e.allDilemmas.map(e=>e.id===o?l(i({},e),{summaryLoading:!1}):e)}))}}}),dismissReport:e=>m(null,null,function*(){throw new Error("Moderator profile not found")}),removePost:e=>m(null,null,function*(){throw new Error("Moderator profile not found")})}});S.getState().fetchDilemmas();const D=d((e,a)=>({helpSessions:[],videoChatDilemmaId:null,pendingVideoChatDilemmaId:null,isVideoConsentModalOpen:!1,fetchHelpSessions:()=>m(null,null,function*(){}),getHelpSessionByDilemmaId:e=>a().helpSessions.find(a=>a.dilemmaId===e),toggleFavorite:e=>m(null,null,function*(){}),sendKudos:e=>m(null,null,function*(){}),generateSeekerSummary:o=>m(null,null,function*(){const s=a().helpSessions.find(e=>e.id===o);if(s){e(e=>({helpSessions:e.helpSessions.map(e=>e.id===o?l(i({},e),{summaryLoading:!0}):e)}));try{const a=(yield c.chat.getMessages(s.dilemmaId)).map(e=>`${"poster"===e.sender?"Seeker":"Helper"}: ${e.text}`).join("\n"),t=yield c.ai.summarizeChat(a);e(e=>({helpSessions:e.helpSessions.map(e=>e.id===o?l(i({},e),{summary:t,summaryLoading:!1}):e)}))}catch(t){throw e(e=>({helpSessions:e.helpSessions.map(e=>e.id===o?l(i({},e),{summaryLoading:!1}):e)})),t}}}),generateHelperPerformanceSummary:a=>m(null,null,function*(){e(e=>({helpSessions:e.helpSessions.map(e=>e.id===a?l(i({},e),{helperSummaryLoading:!0}):e)}));try{const o=yield c.ai.summarizeHelperPerformance("");e(e=>({helpSessions:e.helpSessions.map(e=>e.id===a?l(i({},e),{helperSummary:o,helperSummaryLoading:!1}):e)}))}catch(o){e(e=>({helpSessions:e.helpSessions.map(e=>e.id===a?l(i({},e),{helperSummaryLoading:!1}):e)}))}}),startVideoChat:a=>{e({pendingVideoChatDilemmaId:a,isVideoConsentModalOpen:!0})},acceptVideoConsent:()=>{const o=a().pendingVideoChatDilemmaId;o&&e({videoChatDilemmaId:o,pendingVideoChatDilemmaId:null,isVideoConsentModalOpen:!1})},declineVideoConsent:()=>{e({pendingVideoChatDilemmaId:null,isVideoConsentModalOpen:!1})},endVideoChat:()=>{e({videoChatDilemmaId:null})}})),A=d((e,a)=>({chatSessions:{},activeChatId:null,lastChatDilemmaId:null,guidance:null,isFeedbackModalOpen:!1,get activeChat(){const{activeChatId:e,chatSessions:o}=a();return e?o[e]:null},get hasUnreadNotifications(){return Object.values(a().chatSessions).some(e=>e.unread)},openFeedbackModal:()=>e({isFeedbackModalOpen:!0}),closeFeedbackModal:()=>e({isFeedbackModalOpen:!1}),startChat:(a,o)=>m(null,null,function*(){try{const s=yield c.chat.getMessages(a),t=D.getState().getHelpSessionByDilemmaId(a),n=S.getState().getDilemmaById(a),r=null==n?void 0:n.assignedHelperId,m=r?yield c.helpers.getById(r):void 0;e(e=>l(i({},e),{chatSessions:l(i({},e.chatSessions),{[a]:{dilemmaId:a,messages:s,unread:!1,isTyping:!1,perspective:o,helpSessionId:null==t?void 0:t.id,helper:m||void 0}}),activeChatId:a}))}catch(s){}}),closeChat:o=>{const{chatSessions:s}=a(),t=s[o];null==t||t.helpSessionId,e({activeChatId:null,lastChatDilemmaId:o,isFeedbackModalOpen:!0,guidance:null})},sendMessage:(o,s)=>m(null,null,function*(){var t;const{activeChat:n}=a(),r=S.getState().getDilemmaById(o),m="seeker"===(null==n?void 0:n.perspective)?"poster":"user",d="seeker"===(null==n?void 0:n.perspective)?null==r?void 0:r.userToken:null==(t=g)?void 0:t.id;if(!d)return;const p={id:crypto.randomUUID(),sender:m,text:s,timestamp:(new Date).toISOString()};e(e=>{var a,s;return{chatSessions:l(i({},e.chatSessions),{[o]:l(i({},e.chatSessions[o]),{messages:[...null!=(s=null==(a=e.chatSessions[o])?void 0:a.messages)?s:[],p]})})}});const u=yield c.chat.sendMessage(o,s,m,d);if(e(e=>({chatSessions:l(i({},e.chatSessions),{[o]:l(i({},e.chatSessions[o]),{messages:e.chatSessions[o].messages.map(e=>e.id===p.id?u:e)})})})),"poster"===m&&"helper"===(null==n?void 0:n.perspective))try{const a=yield c.ai.getHelperGuidance(s);(a.isCrisis||a.flagReason&&"none"!==a.flagReason)&&e({guidance:l(i({},a),{dilemmaId:o})})}catch(_){}}),setTyping:(a,o)=>{e(e=>({chatSessions:l(i({},e.chatSessions),{[a]:l(i({},e.chatSessions[a]),{isTyping:o})})}))},submitFeedback:o=>m(null,null,function*(){const{lastChatDilemmaId:s}=a();if(s){const e=S.getState().getDilemmaById(s);(null==e?void 0:e.assignedHelperId)&&(yield c.feedback.submitFeedback(e.id,e.assignedHelperId,o))}e({lastChatDilemmaId:null,isFeedbackModalOpen:!1})}),dismissGuidance:()=>e({guidance:null})})),P=d(e=>({contentFilters:[],loadFilters:()=>{try{const a=localStorage.getItem("contentFilters");a&&""!==a.trim()&&e({contentFilters:JSON.parse(a)})}catch(a){localStorage.removeItem("contentFilters")}},setFilters:a=>{e({contentFilters:a}),localStorage.setItem("contentFilters",JSON.stringify(a))}}));P.getState().loadFilters();const h=d((e,a)=>({history:[],journalEntries:[],isLoading:!0,predefinedHabits:[],trackedHabits:[],isLoadingHabits:!0,completions:[],fetchHistory:()=>m(null,null,function*(){e({history:[],isLoading:!1})}),postCheckIn:e=>m(null,null,function*(){throw new Error("User token is not available.")}),fetchJournalEntries:()=>m(null,null,function*(){e({journalEntries:[]})}),postJournalEntry:e=>m(null,null,function*(){throw new Error("User token is not available.")}),fetchHabits:()=>m(null,null,function*(){e({predefinedHabits:[],trackedHabits:[],completions:[],isLoadingHabits:!1})}),trackHabit:e=>m(null,null,function*(){}),untrackHabit:e=>m(null,null,function*(){}),logCompletion:e=>m(null,null,function*(){})})),O=d(e=>({reflections:[],isLoading:!1,error:null,setReflections:a=>e({reflections:a}),addReflection:a=>e(e=>({reflections:[a,...e.reflections]})),updateReaction:(a,o,s)=>e(e=>({reflections:e.reflections.map(e=>{if(e.id===a){const a=i({},e.reactions);return s&&!e.myReaction&&(a[o]=(a[o]||0)+1),l(i({},e),{reactions:a,myReaction:s||e.myReaction})}return e})})),setLoading:a=>e({isLoading:a}),setError:a=>e({error:a})}));export{I as a,P as b,S as c,D as d,h as e,O as f,A as u};
